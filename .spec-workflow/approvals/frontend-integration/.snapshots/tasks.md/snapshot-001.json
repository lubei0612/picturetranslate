{
  "id": "snapshot_1764817434571_05gz5cn38",
  "approvalId": "approval_1764817434569_1sdxgqb05",
  "approvalTitle": "Tasks Breakdown - 5个阶段任务分解",
  "version": 1,
  "timestamp": "2025-12-04T03:03:54.571Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks: Frontend Integration\n\n## Overview\n\n将 picturetranslate 重构为 FastAPI + React 前后端分离架构。\n\n## Task Breakdown\n\n### Phase 1: 后端基础设施\n\n#### Task 1.1: 核心配置模块\n- [ ] 1.1.1 创建 `core/__init__.py`\n- [ ] 1.1.2 创建 `core/config.py` - pydantic-settings 环境变量管理\n- [ ] 1.1.3 创建 `core/exceptions.py` - 自定义异常和处理器\n\n_Requirements: REQ-1_\n_Estimate: 30 min_\n\n#### Task 1.2: 工具层\n- [ ] 1.2.1 创建 `utils/__init__.py`\n- [ ] 1.2.2 创建 `utils/image.py` - 图片验证、hash 计算\n- [ ] 1.2.3 创建 `utils/retry.py` - 重试装饰器\n\n_Requirements: REQ-1_\n_Estimate: 30 min_\n\n#### Task 1.3: 服务层\n- [ ] 1.3.1 创建 `services/__init__.py`\n- [ ] 1.3.2 创建 `services/translator.py` - 封装 processor.ImageTranslator\n- [ ] 1.3.3 创建 `services/cache.py` - LRU 缓存服务\n\n_Requirements: REQ-1_\n_Estimate: 45 min_\n\n### Phase 2: API 层\n\n#### Task 2.1: FastAPI 应用入口\n- [ ] 2.1.1 创建 `api/__init__.py`\n- [ ] 2.1.2 创建 `api/main.py` - FastAPI 应用、CORS、生命周期\n- [ ] 2.1.3 创建 `api/dependencies.py` - 依赖注入\n\n_Requirements: REQ-1_\n_Estimate: 30 min_\n\n#### Task 2.2: 健康检查路由\n- [ ] 2.2.1 创建 `api/routes/__init__.py`\n- [ ] 2.2.2 创建 `api/routes/health.py` - GET /health\n\n_Requirements: REQ-1_\n_Estimate: 15 min_\n\n#### Task 2.3: 翻译路由\n- [ ] 2.3.1 创建 `api/routes/translate.py` - POST /api/translate\n- [ ] 2.3.2 实现 multipart/form-data 上传\n- [ ] 2.3.3 实现 ThreadPoolExecutor 异步执行\n- [ ] 2.3.4 集成缓存服务\n\n_Requirements: REQ-1, REQ-4_\n_Estimate: 60 min_\n\n### Phase 3: 部署配置\n\n#### Task 3.1: 依赖更新\n- [ ] 3.1.1 更新 `requirements.txt` - 添加 fastapi, uvicorn, pydantic-settings, python-multipart\n\n_Requirements: REQ-1_\n_Estimate: 10 min_\n\n#### Task 3.2: Dockerfile 更新\n- [ ] 3.2.1 更新 `Dockerfile` - 改用 uvicorn 启动\n- [ ] 3.2.2 更新 `docker-compose.yml` - 端口映射 8000\n\n_Requirements: REQ-1_\n_Estimate: 15 min_\n\n### Phase 4: 测试验证\n\n#### Task 4.1: 单元测试\n- [ ] 4.1.1 创建 `tests/test_utils.py` - 测试图片验证、hash\n- [ ] 4.1.2 创建 `tests/test_services.py` - 测试缓存服务\n\n_Requirements: REQ-1_\n_Estimate: 30 min_\n\n#### Task 4.2: API 集成测试\n- [ ] 4.2.1 创建 `tests/test_api.py` - 测试 /health, /api/translate\n- [ ] 4.2.2 添加 pytest, httpx 测试依赖\n\n_Requirements: REQ-1, REQ-4_\n_Estimate: 45 min_\n\n#### Task 4.3: 本地验证\n- [ ] 4.3.1 启动 FastAPI 服务并测试健康检查端点\n- [ ] 4.3.2 测试翻译接口\n- [ ] 4.3.3 验证错误处理\n\n_Requirements: REQ-1, REQ-4_\n_Estimate: 20 min_\n\n### Phase 5: 前端集成\n\n#### Task 5.1: API Client\n- [ ] 5.1.1 创建 `src/api/translateClient.ts`\n- [ ] 5.1.2 实现 translateImage 函数\n\n_Requirements: REQ-2_\n_Estimate: 20 min_\n\n#### Task 5.2: React Hook\n- [ ] 5.2.1 创建 `src/hooks/useTranslation.ts`\n- [ ] 5.2.2 实现状态管理和错误处理\n\n_Requirements: REQ-2, REQ-4_\n_Estimate: 30 min_\n\n#### Task 5.3: Dashboard 集成\n- [ ] 5.3.1 修改 Dashboard 组件，接入 useTranslation hook\n- [ ] 5.3.2 实现上传、语言选择、翻译按钮\n\n_Requirements: REQ-2_\n_Estimate: 45 min_\n\n#### Task 5.4: Editor 集成\n- [ ] 5.4.1 修改 Editor 组件，显示翻译结果\n- [ ] 5.4.2 实现下载功能\n\n_Requirements: REQ-3_\n_Estimate: 30 min_\n\n## Acceptance Criteria\n\n- [ ] 99.1 `GET /health` 返回 200 + JSON\n- [ ] 99.2 `POST /api/translate` 接受图片，返回 PNG\n- [ ] 99.3 错误响应符合 API Contract\n- [ ] 99.4 所有单元测试通过\n- [ ] 99.5 Docker 构建成功\n- [ ] 99.6 前端可正常调用后端 API\n",
  "fileStats": {
    "size": 3629,
    "lines": 138,
    "lastModified": "2025-12-04T03:03:47.913Z"
  },
  "comments": []
}